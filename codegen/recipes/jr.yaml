model_name: JR
full_name: Jansen Rit
citations:
  - Jansen and Rit 1995 Biological Cybernetics (10.1007/BF00199471) # original description
  - Ritter et al. 2013 Brain Connectivity (10.1089/brain.2012.0120) # TVB: implementation

init_equations: |
  y0 = 0.0
  y1 = 0.0
  y2 = 0.0
  y3 = 0.0
  y4 = 0.0
  y5 = 0.0
  y1_y2 = 0.0
  s_y1_y2 = 0.0

step_equations: |
  # Sigmoid terms
  sigm_y1_y2 = 2.0 * nu_max / (1.0 + exp(r * (v0 - (y1 - y2))))
  sigm_y0_1  = 2.0 * nu_max / (1.0 + exp(r * (v0 - (a_1 * J * y0))))
  sigm_y0_3  = 2.0 * nu_max / (1.0 + exp(r * (v0 - (a_3 * J * y0))))
  
  # State variable derivatives
  y0_dot = y3
  y1_dot = y4
  y2_dot = y5
  y3_dot = A * a * sigm_y1_y2 - 2.0 * a * y3 - (pow(a, 2)) * y0
  y4_dot = A * a * (mu + a_2 * J * sigm_y0_1 + G * globalinput) - 2.0 * a * y4 - (pow(a, 2)) * y1
  y5_dot = B * b * (a_4 * J * sigm_y0_3) - 2.0 * b * y5 - (pow(b, 2)) * y2
  
  # Integration step
  y0 += dt * y0_dot
  y1 += dt * y1_dot
  y2 += dt * y2_dot
  y3 += dt * y3_dot + sqrt_dt * noise * sigma
  y4 += dt * y4_dot
  y5 += dt * y5_dot
  
  # Calculate y1_y2 and s(y1_y2) which
  # are the non-integrated state variables
  # needed for BOLD and connectivity
  y1_y2 = y1 - y2
  # s_y1_y2 is the sigmoid of y1_y2 which will be the
  # connectivity state variable, i.e., the output to
  # the other connected nodes. This is calculated based
  # on SigmoidalJansenRit.pre() method in TVB
  s_y1_y2 = cmin + (cmax - cmin) / (1.0 + exp(r * (midpoint - (y1_y2))))

conn_state_var: s_y1_y2
is_osc: false

bold_state_var: y1_y2

variables:
  - name: y0
    type: state_var
    description: ""
    
  - name: y1
    type: state_var
    description: ""
    
  - name: y2
    type: state_var
    description: ""
    
  - name: y3
    type: state_var
    description: ""
    
  - name: y4
    type: state_var
    description: ""
    
  - name: y5
    type: state_var
    description: ""
    
  - name: y1_y2
    type: state_var
    description: ""
    
  - name: s_y1_y2
    type: state_var
    description: ""
    
  - name: sigm_y1_y2
    type: intermediate_var
    description: ""
    
  - name: sigm_y0_1
    type: intermediate_var
    description: ""
    
  - name: sigm_y0_3
    type: intermediate_var
    description: ""
    
  - name: y0_dot
    type: intermediate_var
    description: ""
    
  - name: y1_dot
    type: intermediate_var
    description: ""
    
  - name: y2_dot
    type: intermediate_var
    description: ""
    
  - name: y3_dot
    type: intermediate_var
    description: ""
    
  - name: y4_dot
    type: intermediate_var
    description: ""
    
  - name: y5_dot
    type: intermediate_var
    description: ""
    
  - name: G
    type: global_param
    description: global coupling strength
    # no default
    
  - name: J
    type: regional_param
    description: average number of synapses
    value: 135.0
    
  - name: a_1
    type: regional_param
    description: average probability of synapses in feedback excitatory loop
    value: 1.0
    
  - name: a_2
    type: regional_param
    description: average probability of synapses in slow feedback excitatory loop
    value: 0.8
    
  - name: a_3
    type: regional_param
    description: average probability of synapses in feedback inhibitory loop
    value: 0.25
    
  - name: a_4
    type: regional_param
    description: average probability of synapses in slow feedback inhibitory loop
    value: 0.25
    
  - name: sigma
    type: regional_param
    description: local noise sigma
    value: 0.0001
    
  - name: noise
    type: noise
    description: noise for y3

constants:
  - type: double
    name: dt
    value: dt
    description: integration step
    
  - type: double
    name: sqrt_dt
    value: sqrt(mc.dt)
    description: square root of integration step
    
  - type: double
    name: A
    value: "3.25"
    description: max amplitude of EPSPs (mV)
    
  - type: double
    name: B
    value: "22.0"
    description: max amplitude of IPSPs (mV)
    
  - type: double
    name: a
    value: "0.1"
    description: inverse of the time constant for EPSPs (1/msec)
    
  - type: double
    name: b
    value: "0.05"
    description: inverse of the time constant for IPSPs (1/msec)
    
  - type: double
    name: v0
    value: "6.0"
    description: Firing threshold (PSP) resulting in 50% firing rate (mV)
    
  - type: double
    name: nu_max
    value: "0.0025"
    description: maximum firing rate (1/msec)
    
  - type: double
    name: r
    value: "0.56"
    description: steepness of the sigmoidal transformation (1/mV)
    
  - type: double
    name: p_min
    value: "0.12"
    description: minimum input firing rate
    
  - type: double
    name: p_max
    value: "0.32"
    description: maximum input firing rate
    
  - type: double
    name: mu
    value: "0.22"
    description: ""
    
  - type: double
    name: cmin
    value: "0.0"
    description: minimum of sigmoid function
    
  - type: double
    name: cmax
    value: "0.005"
    description: maximum of sigmoid function
    
  - type: double
    name: midpoint
    value: "6.0"
    description: midpoint of the linear portion of the sigmoid function

python_config:
  sel_state_var: y1_y2

  # TODO: labels